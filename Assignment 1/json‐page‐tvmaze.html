<!DOCTYPE html>
<html>
  <header>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <link type="text/css" rel="stylesheet" href="js-page1-style3.css" />
  </header>
  <body>
    <h1 id="title">My Favourite TV Shows</h1>
    <script>
      var urls = [
        "http://api.tvmaze.com/shows/2368",
        "http://api.tvmaze.com/shows/2368/cast",
        "http://api.tvmaze.com/shows/13814",
        "http://api.tvmaze.com/shows/13814/cast",
        "http://api.tvmaze.com/shows/40",
        "http://api.tvmaze.com/shows/40/cast",
        "http://api.tvmaze.com/shows/1905",
        "http://api.tvmaze.com/shows/1905/cast",
        "http://api.tvmaze.com/shows/2071",
        "http://api.tvmaze.com/shows/2071/cast"
      ];

      var dbs = [
        "https://www.youtube.com/embed/DanemKSoytI",
        "https://www.youtube.com/embed/t_4j8RLrbHY",
        "https://www.youtube.com/embed/Y6qr6qxwOMY"
      ];
      var exorcist = [
        "https://www.youtube.com/embed/p_X5oXO_ZQc",
        "https://www.youtube.com/embed/GkuEbpCJot0",
        "https://www.youtube.com/embed/PhC9p252bKc"
      ];
      var death = [
        "https://www.youtube.com/embed/GHilgpeyZHI",
        "https://www.youtube.com/embed/fAA7uYqayEc",
        "https://www.youtube.com/embed/B7Jq9SNZMtw"
      ];

      var bleach = [
        "https://www.youtube.com/embed/5LIIRCJZAdk",
        "https://www.youtube.com/embed/oZ67d9XSjFs",
        "https://www.youtube.com/embed/wyw3e-qS7-M"
      ];

      var alchemist = [
        "https://www.youtube.com/embed/MzdRXA1uiNc",
        "https://www.youtube.com/embed/_FTya_31JUk",
        "https://www.youtube.com/embed/3fwXn8Ms0Is"
      ];

      function retrieveAnime(showUrls) {
        var requests = []

        showUrls.forEach(function(url) {
          requests.push($.getJSON(url));
        });

        $.when.apply($, requests).done(displayShows);
      }

      function displayShows() {
        var results = arguments;
        for (var i = 0; i < results.length; i+=2) {
          var show = results[i][0];
          var cast = results[i+1][0];

          var castText = '';

          for (var j = 0; j < cast.length; j++) {
            castText += (cast[j].person.name + '; ');
          }

          var table = $('table');
          table.append('<tr>' +
            '<td>' + show.name + '</td>' +
            '<td>' + show.url + '</td>' +
            '<td>' + show.summary + '</td>' +
            '<td>' + castText + '</td>' +
            '<td>' + randomizeShows(show.name) + '</td>' +
            '</tr>'
          );
        }
      }

      function randomizeShows(name) {
        var randomIndex = Math.floor(Math.random() * 3);
        var url = '';

        switch(name) {
          case 'Dragon Ball Super': {
            url = dbs[randomIndex];
            break;
          }
          case 'Sousei no Onmyouji': {
            url = exorcist[randomIndex];
            break;
          }
          case 'Death Note': {
            url = death[randomIndex];
            break;
          }
          case 'Bleach': {
            url = bleach[randomIndex];
            break;
          }
          case 'Fullmetal Alchemist: Brotherhood': {
            url = alchemist[randomIndex];
            break;
          }
        }

        return '<iframe width="560" height="315" src="' + url + '" frameborder="0" allowfullscreen></iframe>';
      }

      retrieveAnime(urls);
    </script>

    <div>
      <table>
        <tr>
          <th>Name of the Show</th>
          <th>URL of the Show</th>
          <th>Short Summary</th>
          <th>Main Cast</th>
          <th>Trailer</th>
        </tr>
      </table>
    </div>
  </body>
</html>
